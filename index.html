<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart CV Generator</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f4f8;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    .row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .row input, .row select, .row textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .section {
      margin-bottom: 25px;
    }
    .add-btn, .fill-btn, .action-btn {
      background-color: #28a745;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 5px;
    }
    .fill-btn {
      background-color: #ffc107;
      margin-left: auto;
      display: block;
    }
    .action-btn {
      background-color: #0066cc;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      width: 100%;
      box-sizing: border-box;
    }
    .action-btn:hover {
      background-color: #0052a3;
    }
    /* Mobile Responsiveness (adjusts to keep a two-column layout) */
    @media (max-width: 768px) {
      .row {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .row input, .row select, .row textarea {
        flex: 1 1 45%;
      }
    }
    @media (max-width: 480px) {
        .row input, .row select, .row textarea {
            flex: 1 1 100%;
        }
    }
    /* CV Display Styles */
    #cv-output {
        display: none;
    }
    .cv-box {
      max-width: 850px;
      margin: auto;
      background: #fff;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    .cv-box h2 {
      text-align: center;
      color: #0052a3;
      margin-bottom: 5px;
    }
    .cv-box h3 {
      color: #333;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
      margin-top: 30px;
      margin-bottom: 15px;
    }
    .cv-box .section p {
      margin: 8px 0;
    }
    .cv-box .personal-info p {
      margin: 6px 0;
    }
    .education-entry {
      margin-bottom: 20px;
      padding-left: 5px;
    }
    .responsibility-list {
      margin-top: 5px;
      padding-left: 20px;
    }
    .responsibility-list li {
      margin-bottom: 5px;
    }
    .download-btn, .back-btn {
      margin: 30px 5px 0;
      background: linear-gradient(135deg, #007bff, #0052a3);
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 13px;
      display: inline-block;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: background 0.3s ease;
    }
    .download-btn:hover, .back-btn:hover {
      background: linear-gradient(135deg, #0052a3, #003b80);
    }
    .back-btn {
        background: #6c757d;
    }
    .back-btn:hover {
        background: #5a6268;
    }
    /* Hide elements from the PDF */
    .html2pdf-ignore {
      display: none;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 13px;
      color: #999;
    }
    .goodbye-message {
        text-align: center;
        margin-top: 30px;
        font-style: italic;
        color: #666;
    }
  </style>
</head>
<body>
  <div id="form-container" class="container">
    <h2>Smart CV Generator</h2>
    <form id="cv-form" onsubmit="event.preventDefault(); generateCV();">
      <div class="row">
        <input type="text" name="first_name" id="first_name" placeholder="First Name" required>
        <input type="text" name="last_name" id="last_name" placeholder="Last Name" required>
      </div>

      <div class="row">
        <input type="email" name="email" id="email" placeholder="Email" required>
        <input type="text" name="phone" id="phone" placeholder="Phone Number" required>
      </div>

      <div class="row">
        <input type="text" name="address" id="address" placeholder=" Physical Address">
        <input type="text" name="linkedin" id="linkedin" placeholder="LinkedIn (Optional)">
      </div>

      <div class="row">
        <input type="text" name="job_title" id="jobTitle" placeholder="Current Job Title" required>
        <input type="text" name="skills" id="skills" placeholder="Skills (comma separatede.g time management,Basic computer skills)" required>
      </div>

      <div class="row">
        <textarea name="summary" id="summary" rows="3" placeholder="Professional Summary (Auto-filled)"></textarea>
      </div>

      <div class="section">
        <label><strong>Education</strong></label>
        <div id="educationFields">
          <div class="row education-entry-fields">
            <input type="text" name="school[]" placeholder="School Name" required>
            <select name="level[]" onchange="autoFillQual(this)">
              <option value="">Select Level</option>
              <option value="Primary">Primary</option>
              <option value="High School">High School</option>
              <option value="College">College</option>
              <option value="University">University</option>
            </select>
          </div>
          <div class="row">
            <input type="text" name="qualification[]" placeholder="Qualification( Auto-filled )" class="qual">
            <input type="text" name="year[]" placeholder="Year Completed">
          </div>
        </div>
        <button type="button" class="add-btn" onclick="addEducation()">+ Add More Education</button>
      </div>

      <div class="section">
        <label><strong>Work Experience</strong></label>
        <div id="experienceFields">
          <div class="row experience-entry-fields">
            <input type="text" name="company[]" placeholder="Company/Place Worked">
            <input type="text" name="position[]" placeholder="Position/Role" class="position-input">
          </div>
          <div class="row">
            <textarea name="responsibilities[]" placeholder="Main Responsibilities (one per line)" class="responsibility-field" rows="3"></textarea>
            <input type="text" name="exp_year[]" placeholder="Year Completed">
          </div>
          <button type="button" class="fill-btn" onclick="autoFillResponsibility(this)">Auto-fill Responsibilities</button>
        </div>
        <button type="button" class="add-btn" onclick="addExperience()">+ Add More Experience</button>
      </div>

      <div class="section">
        <label><strong>Referees</strong></label>
        <div id="refereeFields">
          <div class="row referee-entry-fields">
            <input type="text" name="referee_name[]" placeholder="Referee Name">
            <input type="text" name="referee_contact[]" placeholder="Referee Contact">
          </div>
        </div>
        <button type="button" class="add-btn" onclick="addReferee()">+ Add More Referees</button>
      </div>

      <button type="submit" class="action-btn">Generate CV</button>
    </form>
  </div>

  <div id="cv-output" class="cv-box">
    <h2 id="cv-name"></h2>

    <div class="section personal-info">
      <p><strong>Email:</strong> <span id="cv-email"></span></p>
      <p><strong>Phone:</strong> <span id="cv-phone"></span></p>
      <p><strong>Address:</strong> <span id="cv-address"></span></p>
      <p id="cv-linkedin-p"><strong>LinkedIn:</strong> <span id="cv-linkedin"></span></p>
    </div>

    <div class="section">
      <h3>Professional Summary</h3>
      <p id="cv-summary"></p>
    </div>

    <div class="section">
      <h3>Skills</h3>
      <p id="cv-skills"></p>
    </div>

    <div class="section">
      <h3>Education</h3>
      <div id="cv-education"></div>
    </div>

    <div class="section">
      <h3>Work Experience</h3>
      <div id="cv-experience"></div>
    </div>

    <div class="section">
      <h3>Referees</h3>
      <div id="cv-referees"></div>
    </div>
    
    <div class="html2pdf-ignore" style="text-align: center;">
      <button class="back-btn" onclick="showForm()">← Back to Form</button>
      <button class="download-btn" onclick="downloadCV()">⬇️ Download CV</button>
    </div>

    <p class="goodbye-message html2pdf-ignore">Thanks for using Orlando's Smart CV Generator!</p>

    <div class="footer html2pdf-ignore">
      © OrlantechInnovations. All rights Reserved.
    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    // Autofill summary
    function setupAutoFillSummary() {
      const jobTitleInput = document.getElementById("jobTitle");
      jobTitleInput.addEventListener("blur", function () {
        const title = this.value.toLowerCase();
        const summary = document.getElementById("summary");
        if (summary.value.trim() === "") {
          if (title.includes("cleaner")) {
            summary.value = "A hardworking and dependable cleaner with experience in maintaining hygienic environments and delivering quality service.";
          } else if (title.includes("teacher")) {
            summary.value = "An experienced and dedicated teacher committed to inspiring students and delivering impactful education.";
          } else if (title) {
            summary.value = `A dedicated and skilled ${this.value} with a proven ability to contribute effectively in fast-paced environments.`;
          } else {
            summary.value = "A reliable and goal-driven individual with excellent teamwork and communication skills, seeking opportunities to contribute and grow.";
          }
        }
      });
    }
    setupAutoFillSummary();

    // Autofill qualification based on level
    function autoFillQual(select) {
      const value = select.value;
      const qualInput = select.closest('.row').nextElementSibling.querySelector('.qual');
      if (value === "Primary") {
        qualInput.value = "Kenya Certificate of Primary Education";
      } else if (value === "High School") {
        qualInput.value = "Attained Kenya Certificate of Secondary Education";
      } else if (value === "College") {
        qualInput.value = "Attained Diploma Certificate";
      } else if (value === "University") {
        qualInput.value = "Attained A Bachelors Degree";
      } else {
        qualInput.value = "";
      }
    }

    // Add education
    function addEducation() {
      const container = document.getElementById("educationFields");
      container.insertAdjacentHTML('beforeend', `
        <div class="row education-entry-fields">
          <input type="text" name="school[]" placeholder="School Name" required>
          <select name="level[]" onchange="autoFillQual(this)">
            <option value="">Select Level</option>
            <option value="Primary">Primary</option>
            <option value="High School">High School</option>
            <option value="College">College</option>
            <option value="University">University</option>
          </select>
        </div>
        <div class="row">
          <input type="text" name="qualification[]" placeholder="Qualification" class="qual">
          <input type="text" name="year[]" placeholder="Year Completed">
        </div>
      `);
    }

    // Add experience
    function addExperience() {
      const container = document.getElementById("experienceFields");
      container.insertAdjacentHTML('beforeend', `
        <div class="row experience-entry-fields">
          <input type="text" name="company[]" placeholder="Company/Place Worked">
          <input type="text" name="position[]" placeholder="Position/Role" class="position-input">
        </div>
        <div class="row">
          <textarea name="responsibilities[]" placeholder="Main Responsibilities (one per line)" class="responsibility-field" rows="3"></textarea>
          <input type="text" name="exp_year[]" placeholder="Year Completed">
        </div>
        <button type="button" class="fill-btn" onclick="autoFillResponsibility(this)">Auto-fill Responsibilities</button>
      `);
    }

    // Add referee
    function addReferee() {
      const container = document.getElementById("refereeFields");
      container.insertAdjacentHTML('beforeend', `
        <div class="row referee-entry-fields">
          <input type="text" name="referee_name[]" placeholder="Referee Name">
          <input type="text" name="referee_contact[]" placeholder="Referee Contact">
        </div>
      `);
    }

    // Auto-fill responsibilities based on position
    function autoFillResponsibility(btn) {
      const section = btn.previousElementSibling.previousElementSibling;
      const position = section.querySelector('.position-input').value.toLowerCase();
      const respField = section.nextElementSibling.querySelector('.responsibility-field');

      let responsibilities = '';
      if (position.includes("cleaner")) {
        responsibilities = "• Sweeping and mopping floors\n• Disposing trash daily\n• Sanitizing surfaces\n• Restocking cleaning supplies";
      } else if (position.includes("waiter")) {
        responsibilities = "• Taking customer orders\n• Serving food and drinks\n• Cleaning tables and dining surfaces\n• Handling payments";
      } else if (position.includes("receptionist")) {
        responsibilities = "• Receiving guests\n• Answering phone calls\n• Scheduling appointments\n• Managing front desk operations";
      } else if (position.includes("shop") || position.includes("attendant")) {
        responsibilities = "• Assisting customers \n• Managing stock levels\n• Handling cash and Mpesa transactions\n• Keeping the shop clean and tidy at all times";
      } else {
        responsibilities = "Manually enter responsibilities here.";
      }

      respField.value = responsibilities;
    }


    // New functions to handle form submission and CV generation
    function generateCV() {
      // Get all form data
      const first_name = document.getElementById('first_name').value;
      const last_name = document.getElementById('last_name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const linkedin = document.getElementById('linkedin').value;
      const skills = document.getElementById('skills').value;
      const summary = document.getElementById('summary').value;

      // Update personal info section
      document.getElementById('cv-name').textContent = `${first_name} ${last_name}`;
      document.getElementById('cv-email').textContent = email;
      document.getElementById('cv-phone').textContent = phone;
      document.getElementById('cv-address').textContent = address;

      const linkedin_el = document.getElementById('cv-linkedin-p');
      if (linkedin) {
          document.getElementById('cv-linkedin').textContent = linkedin;
          linkedin_el.style.display = 'block';
      } else {
          linkedin_el.style.display = 'none';
      }

      document.getElementById('cv-summary').textContent = summary;
      document.getElementById('cv-skills').textContent = skills;

      // Update Education Section
      const educationContainer = document.getElementById('cv-education');
      educationContainer.innerHTML = ''; // Clear previous content
      const schoolInputs = document.querySelectorAll('input[name="school[]"]');
      schoolInputs.forEach((input, index) => {
          const level = document.querySelectorAll('select[name="level[]"]')[index].value;
          const qualification = document.querySelectorAll('input[name="qualification[]"]')[index].value;
          const year = document.querySelectorAll('input[name="year[]"]')[index].value;

          if (input.value) {
              educationContainer.insertAdjacentHTML('beforeend', `
                <div style="margin-bottom: 20px;">
                  <p><strong>${input.value} – ${level}</strong></p>
                  <p><strong>Year Completed:</strong> ${year}</p>
                  <p><strong>Qualification:</strong> ${qualification}</p>
                </div>
              `);
          }
      });

      // Update Experience Section
      const experienceContainer = document.getElementById('cv-experience');
      experienceContainer.innerHTML = '';
      const companyInputs = document.querySelectorAll('input[name="company[]"]');
      companyInputs.forEach((input, index) => {
          const position = document.querySelectorAll('input[name="position[]"]')[index].value;
          const responsibilities = document.querySelectorAll('textarea[name="responsibilities[]"]')[index].value;
          const exp_year = document.querySelectorAll('input[name="exp_year[]"]')[index].value;

          if (input.value) {
              const responsibilitiesList = responsibilities.split('\n').map(line => `<li>${line.trim()}</li>`).join('');
              experienceContainer.insertAdjacentHTML('beforeend', `
                <p><strong>${position}</strong> – ${input.value} (${exp_year})</p>
                <ul class="responsibility-list">
                  ${responsibilitiesList}
                </ul>
              `);
          }
      });

      // Update Referees Section
      const refereeContainer = document.getElementById('cv-referees');
      refereeContainer.innerHTML = '';
      const refereeNames = document.querySelectorAll('input[name="referee_name[]"]');
      refereeNames.forEach((input, index) => {
          const contact = document.querySelectorAll('input[name="referee_contact[]"]')[index].value;
          if (input.value) {
              refereeContainer.insertAdjacentHTML('beforeend', `
                <p><strong>${input.value}</strong> — ${contact}</p>
              `);
          }
      });

      // Show the CV and hide the form
      document.getElementById('form-container').style.display = 'none';
      document.getElementById('cv-output').style.display = 'block';
    }

    function showForm() {
      document.getElementById('form-container').style.display = 'block';
      document.getElementById('cv-output').style.display = 'none';
    }

    // Function for normal PDF download
    function downloadCV() {
      const element = document.getElementById('cv-output');
      const filename = document.getElementById('first_name').value + '_' + document.getElementById('last_name').value + '_CV.pdf';
      
      const opt = {
        margin: 10,
        filename: filename,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      // Use the .save() method to trigger a normal download
      html2pdf().set(opt).from(element).save();
    }
  </script>
</body>
</html>
